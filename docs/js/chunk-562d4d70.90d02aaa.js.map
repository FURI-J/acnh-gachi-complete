{"version":3,"sources":["webpack:///./src/views/Share.vue?e1af","webpack:///./src/views/Share.vue?f4c1","webpack:///src/views/Share.vue","webpack:///./src/views/Share.vue?0156","webpack:///./src/views/Share.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","navText","sharedUserName","_e","attrs","filter","nav","isShowSaleFilter","on","onChangeFilter","getTotalLength","getCollectedLength","showItems","length","class","tiles","viewMode","_l","item","key","name","sourceSheet","getCollected","renderStartDate","message","staticRenderFns","components","Item","FilterUI","CollectedBar","data","isLoaded","saleFilter","collectedFilter","computed","sharedUid","$route","params","id","sharedCollected","$store","getters","category","indexOf","showNavs","i","mounted","loadOtherFirebaseData","updateShowItems","methods","console","log","db","collection","uniqueEntryId","activeFilter","collected","Object","assign","self","Date","getTime","isSearchMode","searchText","false","result","isSearchResultOverThreshold","push","splice","ite","next","component"],"mappings":"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","file":"js/chunk-562d4d70.90d02aaa.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Share.vue?vue&type=style&index=0&id=4290c12a&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Share.vue?vue&type=style&index=0&id=4290c12a&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"share\"},[_c('h1',{staticClass:\"header\"},[_c('span',{staticClass:\"header-lg\"},[_vm._v(_vm._s(_vm.navText))]),(_vm.isLoaded)?_c('div',{staticClass:\"header-sm\"},[_vm._v(\" \"+_vm._s(_vm.sharedUserName)+\"さんのコンプ状況 \")]):_vm._e()]),_c('div',{staticClass:\"filter\"},[_c('FilterUI',{attrs:{\"filter\":_vm.filter,\"currentNav\":_vm.nav,\"showSaleFilter\":_vm.isShowSaleFilter,\"showBatchAction\":false,\"showShareButton\":false},on:{\"change\":_vm.onChangeFilter}}),_c('CollectedBar',{attrs:{\"totalValue\":_vm.getTotalLength(),\"value\":_vm.getCollectedLength()}})],1),(_vm.showItems && _vm.showItems.length > 0)?_c('ul',{staticClass:\"items\",class:{ tiles: _vm.filter.viewMode === 'tile' }},_vm._l((_vm.showItems),function(item){return _c('Item',{key:item.name + item.sourceSheet,attrs:{\"item\":item,\"collected\":_vm.getCollected(item),\"filter\":_vm.filter,\"isStatic\":true,\"renderStartDate\":_vm.renderStartDate}})}),1):_vm._e(),_c('div',{staticClass:\"message\"},[_vm._v(_vm._s(_vm.message))])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"share\">\n    <h1 class=\"header\">\n      <span class=\"header-lg\">{{ navText }}</span>\n      <div class=\"header-sm\" v-if=\"isLoaded\">\n        {{ sharedUserName }}さんのコンプ状況\n      </div>\n    </h1>\n    <div class=\"filter\">\n      <FilterUI\n        :filter=\"filter\"\n        :currentNav=\"nav\"\n        :showSaleFilter=\"isShowSaleFilter\"\n        :showBatchAction=\"false\"\n        :showShareButton=\"false\"\n        @change=\"onChangeFilter\"\n      />\n      <CollectedBar\n        :totalValue=\"getTotalLength()\"\n        :value=\"getCollectedLength()\"\n      />\n    </div>\n    <ul\n      class=\"items\"\n      :class=\"{ tiles: filter.viewMode === 'tile' }\"\n      v-if=\"showItems && showItems.length > 0\"\n    >\n      <Item\n        v-for=\"item in showItems\"\n        :key=\"item.name + item.sourceSheet\"\n        :item=\"item\"\n        :collected=\"getCollected(item)\"\n        :filter=\"filter\"\n        :isStatic=\"true\"\n        :renderStartDate=\"renderStartDate\"\n      />\n    </ul>\n    <div class=\"message\">{{ message }}</div>\n  </div>\n</template>\n\n<script>\nimport LZString from \"lz-string\";\nimport firebase from \"../plugins/firebase\";\nimport {\n  filterItems,\n  totalLength,\n  collectedLength,\n  getNavText\n} from \"../utils/nav.js\";\n\nimport Item from \"../components/Item.vue\";\nimport FilterUI from \"../components/FilterUI.vue\";\nimport CollectedBar from \"../components/CollectedBar.vue\";\n\nconst db = firebase.firestore();\n\nexport default {\n  components: {\n    Item,\n    FilterUI,\n    CollectedBar\n  },\n  data() {\n    return {\n      sharedUserName: \"\",\n      message: \"データを読み込んでいます。\",\n      isLoaded: false,\n      showItems: [],\n      filter: {\n        saleFilter: \"0\",\n        collectedFilter: \"0\",\n        viewMode: \"tile\"\n      },\n      renderStartDate: null\n    };\n  },\n  computed: {\n    sharedUid() {\n      return this.$route.params.id;\n    },\n    sharedCollected() {\n      return this.$store.getters.sharedCollected;\n    },\n    nav() {\n      return this.$route.params.category;\n    },\n    isShowSaleFilter: function() {\n      if (this.nav) {\n        const showNavs = [\"housewares\", \"walletc\", \"fashion\"];\n        for (let i = 0; i < showNavs.length; i++) {\n          if (this.nav.indexOf(showNavs[i]) !== -1) return true;\n        }\n      }\n      return false;\n    },\n    navText: function() {\n      return getNavText(this.nav);\n    }\n  },\n  mounted() {\n    if (this.sharedCollected === null) {\n      this.loadOtherFirebaseData();\n    } else {\n      this.message = \"\";\n      this.isLoaded = true;\n      this.updateShowItems();\n    }\n  },\n  methods: {\n    loadOtherFirebaseData: function() {\n      console.log(\"load\");\n      const self = this;\n      db.collection(\"users\")\n        .doc(self.sharedUid)\n        .get()\n        .then(function(doc) {\n          if (doc.exists) {\n            const collectedValue = doc.data().collected || {};\n            const collected = JSON.parse(\n              LZString.decompressFromUTF16(collectedValue)\n            );\n            self.$store.commit(\"updateSharedCollected\", collected);\n            self.message = \"\";\n            self.isLoaded = true;\n            self.sharedUserName = doc.data().userName;\n            self.updateShowItems();\n          } else {\n            self.message =\n              \"データを読み込めませんでした。URL が間違えているか、データが存在しません。\";\n            self.isLoaded = true;\n            self.$store.commit(\"updateSharedCollected\", {});\n\n            self.updateShowItems();\n          }\n        })\n        .catch(function() {\n          self.message = \"データを読み込めませんでした。\";\n          self.isLoaded = true;\n          self.$store.commit(\"updateSharedCollected\", {});\n\n          self.updateShowItems();\n        });\n    },\n    getCollected: function(item) {\n      return item.uniqueEntryId\n        ? this.sharedCollected[item.uniqueEntryId]\n        : this.sharedCollected[item.name];\n    },\n    onChangeFilter: function(activeFilter) {\n      this.filter = activeFilter;\n      this.updateShowItems();\n    },\n    getTotalLength: function() {\n      return totalLength({\n        collected: {},\n        nav: this.nav,\n        filter: Object.assign({}, this.filter, { collectedFilter: \"0\" }),\n        isShowSaleFilter: this.isShowSaleFilter\n      });\n    },\n    getCollectedLength: function() {\n      return collectedLength({\n        collected: Object.assign({}, this.sharedCollected),\n        nav: this.nav,\n        filter: Object.assign({}, this.filter, { collectedFilter: \"3\" }),\n        isShowSaleFilter: this.isShowSaleFilter\n      });\n    },\n    updateShowItems: function() {\n      const self = this;\n      self.renderStartDate = new Date().getTime();\n      const renderStartDate = self.renderStartDate;\n\n      let result = filterItems({\n        collected: self.sharedCollected,\n        nav: self.nav,\n        filter: self.filter,\n        isSearchMode: false,\n        isShowSaleFilter: self.isShowSaleFilter,\n        searchText: \"\",\n        false: false\n      });\n      if (result.length < 50) {\n        self.showItems = result;\n        self.isSearchResultOverThreshold = false;\n      } else {\n        // eslint-disable-next-line vue/no-side-effects-in-computed-properties\n        self.isSearchResultOverThreshold = false;\n\n        self.showItems = [];\n        for (let i = 0; i < 50; i++) {\n          const item = result[i];\n          self.showItems.push(item);\n        }\n        result.splice(0, 50);\n\n        const showItems = result;\n        const ite = (function*() {\n          while (true) {\n            const items = showItems.splice(0, 50);\n            if (items.length <= 0 || self.renderStartDate > renderStartDate)\n              break;\n            yield setTimeout(() => {\n              if (self.renderStartDate > renderStartDate) return;\n              for (let len = items.length, i = 0; i < len; i++) {\n                const item = items[i];\n                self.showItems.push(item);\n              }\n              ite.next();\n            });\n          }\n        })();\n        ite.next();\n      }\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.share {\n  text-align: left;\n  margin-bottom: 4rem;\n  user-select: none;\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  padding: 0 1rem;\n  margin-bottom: 0;\n  font-size: 15px;\n  word-break: break-all;\n}\n\n.header-lg {\n  display: inline-flex;\n  margin-right: 1rem;\n  border-bottom: 4px solid #42b983;\n  font-size: 28px;\n  font-weight: 700;\n}\n\n.header-sm {\n  margin: 0.5rem 0;\n  color: #555;\n}\n\n.filter {\n  margin: 1rem 0;\n}\n\n.items {\n  margin: 0;\n  padding: 0;\n\n  &.tiles {\n    text-align: center;\n  }\n}\n\n.message {\n  padding: 1rem;\n  text-align: center;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Share.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Share.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Share.vue?vue&type=template&id=4290c12a&scoped=true&\"\nimport script from \"./Share.vue?vue&type=script&lang=js&\"\nexport * from \"./Share.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Share.vue?vue&type=style&index=0&id=4290c12a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4290c12a\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}